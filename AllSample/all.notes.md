# note.week1.by.swmao

#### 工作内容

- [x] 查看数据[](database_info.md) - 
    - [x] 说明尚在更新

- [x] 准备调取数据的脚本
    - [x] 获取行情（指定股池）复权调整直接价格×复权乘数
    - [x] 获取行业、市值
- [x] [Expected P/E影响因素](explanatory_variables.md)
- [x] P/E 残差
    - [x] 修正为真实值-缩尾后拟合值


#### 会议记录

- 获取数据账号（部分权限，其余因子库等申请）
- 周报；月度报告文档
- 节后提出个人策略，一个月实现之，预测期评估绩效（1.17）
- 当前任务

#### 策略表现

1. pe ~ avgroe + np_chg_6m + np_chg_lid + np_growth + surprise + instnum1 + instnum2 + instnum3 + mv1 + mv2 + mv3
2. pe ~ avgroe + np_chg_6m + np_growth + instnum1 + instnum2 + instnum3 + mv1 + mv2 + mv3
3. pe ~ avgroe + np_chg_lid + np_growth + instnum1 + instnum2 + instnum3 + mv1 + mv2 + mv3
4. pe ~ avgroe + np_growth + surprise + instnum1 + instnum2 + instnum3 + mv1 + mv2 + mv3

#### 所需帮助

1. 回测的价格用复权后的收盘价？——价格*复权因子 看wealth curve
2. 报告年化超预期，同日期同股有多个——取均值
2. 回测期？——涵盖牛熊，5-7年最好
2. 去极值吗？——回归尽量正太
2. 对比本地和服务器时间戳？——无，append更新

<br>

---

# note.week2.by.swmao

#### 工作内容

- [ ] 建立一套多因子回测框架
    - [ ] 参数
        - [x] 分组：ngroups
        - [x] 股池，输入列表 CSI300 CSI500 CSI800
        - [ ] 市值权重（任意标准化的权重表）
    - [ ] 输出资产配比权重
    - [ ] 单独获得全市场基准
    - [x] 输出各分组、各组合日收益
    - [x] 多头、空头、多-空、基准
    - [x] 多-基准、空-基准、多-空-基准
    - [x] 多头回撤
    - [ ] Alpha？
    - [x] 加入cost？
    - [x] 分组结果
    - [x] Total Return of Group
    - [x] Annual Return on Long/Short
    - [ ] Cumulated IC_IR
    - [x] Turnover
    - [x] IC Decay
    - [x] IC Distribution
    - [x] IC Statistics
    - [x] Stats Summary (SemiYear)
        - [x] 夏普
        - [x] 收益
        - [x] 最大回撤
        - [x] 累计净值
    - [ ] ...
- [ ] 整一些研报（C:\Users\Winst\Nutstore\1\我的坚果云\XJIntern\Documents\ 的索引）

#### 会议记录

1. 看wind
2. 因子任务；也自己准备策略，1-2月后自己做组合（组合会教）
3. 买卖单因子（大股；行业）；APM因子
4. 每周结果要存档上传

#### 策略表现

- 本地`factors_res/`回测结果*.csv *.png

#### 所需帮助

1. wind？—— [W1006048048](78360110 -> m1m)
2. `df.to_sql()`如何设置类型？——dtype=dict{}，再手动
3. 行业内只有少量个股，则中性化后无效？——需要人工查看
4. 工作重点以多因子为主 or MLFeatures？——报告思路
5. idx_constituent完整度：CSI800 17年年底开始有；CSI1000缺少——直接全市场
6. 有些股票不包含在行情中，原因？——独立获取全市场作为对比基准
7. 无因子值，如何确定多空分组——生成多头持仓、多头收益

#### 后续计划

- 新增机构：新机构第一次发布该公司相关报告（重点关注）
- 股权激励：过去1年内/1~2年/2~3年有股权激励公告
- 预期差距：新公告发布与旧预期的差距

---

# notes.week3.by.swmao

#### 工作内容

- [ ] 事件：新增机构
    - [x] 文献“事件研究” [事件研究法](https://wiki.mbalib.com/wiki/%E4%BA%8B%E4%BB%B6%E7%A0%94%E7%A9%B6%E6%B3%95)
    - [x] 对齐，超额收益衰减、分布图像
    - [ ] 先验概率；后验概率 -> 下注权重
        - [x] 先验
        - [ ] 新上市
    - [ ] 后验
        - [ ] 次日开盘涨跌停
        - [ ] 次日涨跌停（非开盘）
- [ ] 调整回测
    - [x] 针对事件信号（多数0，不可交易nan，少数1）
    - [ ] 因子收益计算，显著性，打分
    - [ ] 整理到class
        - [ ] self.tab_fv, self.tab_weight (mtd), self.tab_turnover, self.tab_return
        - [ ] self.stk_pool 全市场、300、500、800、1000、机构关注、券商金股与调研
        - [ ] self.baseline(Turnover, Return)
        - [ ] self.freqency 交易频率（短、中、长）
        - [ ] self.strategy_type 不同类型（多空测试、头部测试、事件测试）
    - [ ] 最好合并图表到一张图
- [ ] level2数据
    - [ ] 解压、存储
    - [ ] csv转hdf
    - [ ] 输入层因子构造式

#### 策略表现

**5天持仓信号（等权）**

| PeriodRetOnBookSize | 不去涨跌停 | 去开盘涨跌停 | 去所有涨跌停 |
|---------------------|-------|--------|--------|
| 2016-H1             | 0.09  | 0.08   | 0.00   |
| 2016-H2             | 0.09  | 0.09   | (0.01) |
| 2017-H1             | 0.03  | 0.02   | (0.08) |
| 2017-H2             | 0.08  | 0.08   | (0.08) |
| 2018-H1             | 0.00  | 0.01   | (0.08) |
| 2018-H2             | 0.12  | 0.11   | 0.02   |
| 2019-H1             | 0.60  | 0.58   | 0.32   |
| 2019-H2             | 0.54  | 0.50   | 0.29   |
| 2020-H1             | 0.63  | 0.64   | 0.24   |
| 2020-H2             | 0.46  | 0.44   | 0.10   |
| 2021-H1             | 0.54  | 0.53   | 0.25   |
| 2021-H2             | 0.74  | 0.73   | 0.19   |

| PeriodSharpe | 不去涨跌停 | 去开盘涨跌停 | 去所有涨跌停 |
|--------------|-------|--------|--------|
| 2016-H1      | 0.61  | 0.56   | 0.22   |
| 2016-H2      | 1.07  | 1.04   | (0.01) |
| 2017-H1      | 0.42  | 0.32   | (0.84) |
| 2017-H2      | 0.84  | 0.82   | (0.73) |
| 2018-H1      | 0.16  | 0.19   | (0.55) |
| 2018-H2      | 0.95  | 0.93   | 0.30   |
| 2019-H1      | 3.55  | 3.46   | 2.31   |
| 2019-H2      | 3.96  | 3.76   | 2.52   |
| 2020-H1      | 3.06  | 3.21   | 1.58   |
| 2020-H2      | 2.78  | 2.65   | 0.82   |
| 2021-H1      | 4.58  | 4.47   | 2.69   |
| 2021-H2      | 4.35  | 4.31   | 1.56   |

**滞后期的检验**

- 几张[图](C:\Users\Winst\Documents\factors_res\event_first_report)
- 分别回测连续1...5日持仓信号，表现递减！

#### 所需帮助

- 次新股：ipo后60日
- 停牌后？例如 20210809000792    3.050272
- ST PT？

---

# Literature

Vyas, K., & van Baren, M. (2021). Should Equity Factors Be Betting on Industries?. *The Journal of Portfolio Management*, *48*(1), 73-92.

> **核心观点**
>
> - 大部分大类因子都有行业暴露的倾向，行业暴露对有些因子有利，对有些因子会增加风险；
>
> - 即使是同一类大类因子，不同定义下，因子的表现也不一致；
>
> - 因子模型中，对于行业暴露的控制可以精细化到不同的因子中，而不要一刀切的对所有因子进行行业中性化。



